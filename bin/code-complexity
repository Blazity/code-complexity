#!/usr/bin/env node

const cli = require("../src/cli");
const { displayResult } = require("../src/output");
const { computeComplexity } = require("../src/code-complexity");
const { getRawCommitCount } = require("../src/git-interface");

if (!cli.args || !cli.args.length) {
  cli.help();
  process.exit(0);
}

const directory = cli.args[0];

(async () => {
  const rawCommitCount = await getRawCommitCount(
    directory,
    cli.firstParent,
    cli.since
  );
  const filesComplexity = await computeComplexity(rawCommitCount, directory);
  displayResult(filesComplexity, cli);
})();
